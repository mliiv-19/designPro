{% extends "main.html" %}

{% block title %}Админ-панель - Design.pro{% endblock %}

{% block content %}
    <h1>Панель управления администратора</h1>

    <h2>Все заявки</h2>

    {% if requests %}
        <table border="1" cellpadding="10" cellspacing="0">
            <thead>
            <tr>
                <th>ID</th>
                <th>Дата</th>
                <th>Название</th>
                <th>Описание</th>
                <th>Категория</th>
                <th>Статус</th>
                <th>План помещения</th>
                <th>Дизайн (если есть)</th>
                <th>Комментарий администратора</th>
                <th>Действия</th>
            </tr>
            </thead>
            <tbody>
            {% for req in requests %}
                <tr>
                    <td>{{ req.id }}</td>
                    <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
                    <td>{{ req.title }}</td>
                    <td>{{ req.description }}</td>
                    <td>{{ req.category.name }}</td>
                    <td>{{ req.get_status_display }}</td>
                    <td>
                        {% if req.image %}
                            <a href="{{ req.image.url }}" target="_blank">Посмотреть</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>
                        {% if req.design_image %}
                            <a href="{{ req.design_image.url }}" target="_blank">Посмотреть</a>
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ req.admin_comment|default:"-" }}</td>
                    <td>
                        {% if req.status == 'new' %}
                            <p><a href="{% url 'change_request_status' req.pk %}">Изменить статус</a></p>
                        {% elif req.status == 'in_progress' %}
                            <p><a href="{% url 'change_request_status' req.pk %}">Изменить статус</a></p>
                        {% else %}
                            <span style="color: grey;">Изменить статус (недоступно)</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>Заявок пока нет.</p>
    {% endif %}

    <h3>Категории</h3>
{% if categories %}
<ul>
    {% for category in categories %}
    <li>
        {{ category.name }}
        <a href="{% url 'delete_category' category.pk %}">Удалить</a>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>Категорий нет</p>
{% endif %}
<form method="post" action="{% url 'add_category' %}">
    {% csrf_token %}
    <input type="text" name="name" placeholder="Название категории" required>
    <button type="submit">Добавить категорию</button>
</form>
<li><a href="{% url 'index' %}">Главная</a></li>
{% endblock %}



